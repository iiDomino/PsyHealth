<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>PsyHealthè‡ªæµ‹é‡è¡¨</title>
    <!-- å¼•å…¥ html2canvas ç”¨äºæˆªå›¾ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* åŸºç¡€é‡ç½®ï¼Œç¡®ä¿å…¨å±é«˜åº¦ */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            background: #dbeaf3;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
            box-sizing: border-box;
        }
        .phone {
            max-width: 420px;
            width: 100%;
            height: calc(100vh - 4px);
            background: #ffffff;
            border-radius: 36px 36px 30px 30px;
            box-shadow: 0 20px 40px rgba(0, 45, 70, 0.25);
            overflow: hidden;
            padding: 0 8px 0 8px;
            border: 1px solid rgba(130, 185, 225, 0.35);
            display: flex;
            flex-direction: column;
        }
        .view {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .view.active {
            display: flex;
        }

        /* å‚ç›´å±…ä¸­å®¹å™¨ï¼ˆç”¨äºæ¯ä¸ªè§†å›¾ï¼‰ */
        .centered-wrapper {
            margin: auto 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .header {
            text-align: center;
        }
        .title-main {
            font-size: 1.5rem;
            font-weight: 550;
            letter-spacing: -0.5px;
            color: #0b3b54;
            line-height: 1.2;
            word-break: break-word;
        }

        /* ç­”é¢˜è§†å›¾ */
        .progress-section {
            margin: 0;
        }
        .progress-track {
            background: #d0e4f2;
            height: 6px;
            border-radius: 20px;
            width: 100%;
        }
        .progress-fill {
            background: #21729c;
            height: 6px;
            border-radius: 20px;
            width: 0%;
            transition: width 0.2s ease;
        }
        .card {
            background: #f6fbfe;
            border: 1px solid #c2ddec;
            border-radius: 24px;
            padding: 10px 10px 12px 10px;
            box-shadow: 0 8px 18px -8px #9ebed1;
        }
        .question-num {
            background: #1c6c96;
            color: white;
            display: inline-block;
            padding: 4px 14px;
            border-radius: 60px;
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }
        .question-text {
            font-size: 1.2rem;
            font-weight: 470;
            line-height: 1.4;
            color: #01273a;
            margin-bottom: 12px;
            word-break: break-word;
            min-height: 3rem;
        }
        .option-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .option-btn {
            background: white;
            border: 2px solid #bad2e9;
            border-radius: 100px;
            padding: 7px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.08s;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.03);
        }
        .option-btn:active { background: #ecf6ff; transform: scale(0.99); }
        .option-btn.selected { background: #166b99; border-color: #166b99; }
        .option-marker {
            width: 32px; height: 32px; border-radius: 32px; background: #deeefa;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 1rem; color: #135e86; flex-shrink: 0;
            text-transform: uppercase;
        }
        .option-btn.selected .option-marker { background: white; color: #166b99; }
        .option-text { font-size: 0.95rem; font-weight: 500; color: #0a3b54; word-break: break-word; }
        .option-btn.selected .option-text { color: white; }

        /* å¯¼èˆªæŒ‰é’® */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 6px;
        }
        .nav-btn {
            flex: 1;
            background: white;
            border: 2px solid #30769c;
            border-radius: 60px;
            padding: 8px 0;
            font-size: 0.9rem;
            font-weight: 600;
            color: #1f618b;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            transition: 0.1s;
            text-align: center;
            min-width: 70px;
        }
        .nav-btn:active { background: #e2f0fa; }
        .nav-btn.disabled {
            opacity: 0.3;
            pointer-events: none;
            border-color: #a1b9cc;
        }

        /* å£ä»¤è§†å›¾ - è¾“å…¥æ¡†æ”¹é«˜æ”¹çª„ */
        .password-card {
            background: #f6fbfe;
            border: 1px solid #c2ddec;
            border-radius: 24px;
            padding: 14px 10px;
            box-shadow: 0 8px 18px -8px #9ebed1;
            text-align: center;
            width: 100%;
        }
        .password-title {
            font-size: 1.3rem;
            font-weight: 500;
            color: #0b3b54;
            margin-bottom: 8px;
        }
        .password-input {
            width: 80%;                /* æ”¹çª„ï¼Œå çˆ¶å®¹å™¨80% */
            max-width: 260px;           /* æœ€å¤§å®½åº¦é™åˆ¶ï¼Œé˜²æ­¢è¿‡å®½ */
            margin: 0 auto 8px auto;    /* æ°´å¹³å±…ä¸­ï¼Œåº•éƒ¨é—´è· */
            padding: 10px 12px;         /* å¢åŠ ä¸Šä¸‹å†…è¾¹è·ï¼Œæ”¹é«˜ */
            font-size: 0.9rem;          /* ç¨å¤§ä¸€ç‚¹ */
            border: 2px solid #bad2e9;
            border-radius: 60px;
            text-align: center;
            letter-spacing: 4px;
            background: white;
            outline: none;
            box-sizing: border-box;
            display: block;              /* é…åˆmargin:autoå±…ä¸­ */
        }
        .password-input:focus {
            border-color: #1c6c96;
        }
        .password-btn {
            background: #1c6c96;
            color: white;
            border: none;
            border-radius: 60px;
            padding: 8px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            margin-bottom: 4px;
        }
        .password-btn:active { background: #0f4a70; }
        .password-error {
            color: #c03c2b;
            font-size: 0.8rem;
            margin-top: 4px;
            min-height: 1.5em;
        }
        .back-link {
            color: #30769c;
            font-size: 0.8rem;
            text-decoration: none;
            cursor: pointer;
            display: inline-block;
            margin-top: 6px;
        }

        /* ç»“æœè§†å›¾ */
        .result-header {
            display: flex; align-items: center; justify-content: center;
        }
        .result-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px;
        }
        .factor-card {
            background: white; border-radius: 18px; padding: 6px 4px;
            border-left: 5px solid #4894c0; box-shadow: 0 4px 8px rgba(0,0,0,0.02);
            cursor: pointer; transition: 0.1s;
        }
        .factor-card:active { background: #ecf5fc; }
        .factor-header { display: flex; justify-content: space-between; font-weight: 700; font-size: 0.75rem; color: #14445f; }
        .factor-bar { background: #d2e5f5; height: 4px; border-radius: 20px; margin: 4px 0 4px; }
        .factor-fill { height: 4px; border-radius: 20px; background: #256f94; width: 0%; }
        .factor-score { font-size: 0.55rem; color: #1f6588; word-break: break-word; }
        .global-row {
            background: white; border-radius: 22px; padding: 8px; margin-top: 4px;
            display: flex; flex-wrap: wrap; gap: 6px 8px; font-weight: 500; color: #0a3850;
            font-size: 0.7rem;
        }
        .capture-btn {
            background: #1c6c96;
            color: white;
            border: none;
            border-radius: 60px;
            padding: 7px 10px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 4px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            transition: 0.1s;
            width: 100%;
            text-align: center;
        }
        .capture-btn:active { background: #0f4a70; }

        /* è¯¦æƒ…è§†å›¾ */
        .detail-card {
            background: #f0f8ff;
            border-radius: 24px;
            padding: 10px 10px;
            border: 1px solid #b5d6ed;
            max-height: 50vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .detail-title { font-size: 1.4rem; font-weight: 500; color: #003153; margin-bottom: 4px; word-break: break-word; }
        .detail-sub { font-size: 0.9rem; color: #1f618d; margin-bottom: 4px; font-weight: 400; word-break: break-word; }
        .detail-content { 
            font-size: 0.75rem; 
            line-height: 1.4; 
            color: #123e59; 
            margin-bottom: 8px; 
            background: #e6f2fa; 
            padding: 8px; 
            border-radius: 18px;
            white-space: pre-line;
            word-break: break-word;
        }
        .detail-score { 
            background: #d8e9f5; 
            border-radius: 22px; 
            padding: 8px; 
            margin: 6px 0; 
            font-size: 0.75rem;
        }
        .level-desc {
            background: #cde4f2;
            border-radius: 20px;
            padding: 8px;
            margin: 6px 0;
            font-size: 0.7rem;
            color: #013a55;
        }
        .level-item {
            margin-bottom: 4px;
            padding-left: 6px;
            border-left: 4px solid #1c6c96;
            word-break: break-word;
        }
        .back-from-detail {
            background: #1c6c96; color: white; border: none; border-radius: 60px; padding: 8px;
            font-size: 0.9rem; font-weight: 600; width: 100%; cursor: pointer; margin-top: 4px;
        }

        .developer {
            font-size: 0.5rem;
            color: #5f8baa;
            text-align: center;
            padding-top: 2px;
            border-top: 1px dashed #b8d2e8;
        }
        .footnote {
            font-size: 0.55rem;
            color: #437a9b;
            text-align: center;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
<div class="phone">
    <!-- ç­”é¢˜è§†å›¾ -->
    <div id="quizView" class="view active">
        <div class="centered-wrapper">
            <div class="header">
                <div class="title-main">PsyHealthè‡ªæµ‹é‡è¡¨</div>
            </div>
            <div class="progress-section">
                <div class="progress-track">
                    <div class="progress-fill" id="progressFill" style="width:0%;"></div>
                </div>
            </div>
            <div class="card" id="questionCard">
                <div class="question-num" id="qNum">ç¬¬ 1 / 90 é¢˜</div>
                <div class="question-text" id="qText">å¤´ç—›</div>
                <div class="option-grid" id="optionGrid"></div>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn" disabled>â—€ ä¸Šä¸€é¢˜</button>
                <button class="nav-btn" id="nextBtn" disabled>ä¸‹ä¸€é¢˜ â–¶</button>
            </div>
            <div class="developer">å¼€å‘è€…ï¼šDOMINO Â· ç‰ˆæœ¬ 1.01</div>
        </div>
    </div>

    <!-- å£ä»¤éªŒè¯è§†å›¾ (è¾“å…¥æ¡†å·²æ”¹é«˜æ”¹çª„) -->
    <div id="passwordView" class="view">
        <div class="centered-wrapper">
            <div class="header">
                <div class="title-main">éªŒè¯å£ä»¤</div>
            </div>
            <div class="password-card">
                <div class="password-title">ğŸ”</div>
                <input type="password" id="passwordInput" class="password-input" placeholder="å£ä»¤" maxlength="10" inputmode="numeric">
                <button class="password-btn" id="submitPasswordBtn">ç¡®è®¤æŸ¥çœ‹</button>
                <div id="passwordError" class="password-error"></div>
                <a class="back-link" id="backToQuizFromPasswordBtn">â† è¿”å›ç­”é¢˜é¡µ</a>
            </div>
            <div class="developer">å¼€å‘è€…ï¼šDOMINO Â· ç‰ˆæœ¬ 1.01</div>
        </div>
    </div>

    <!-- ç»“æœæ€»è§ˆè§†å›¾ -->
    <div id="resultView" class="view">
        <div class="centered-wrapper">
            <div class="result-header">
                <div class="title-main">æµ‹è¯„ç»“æœ</div>
            </div>
            <div id="resultCapture">
                <div class="result-grid" id="resultGrid"></div>
                <div class="global-row" id="globalStatsResult"></div>
                <div class="developer">å¼€å‘è€…ï¼šDOMINO Â· ç‰ˆæœ¬ 1.01</div>
            </div>
            <button class="capture-btn" id="captureResultBtn">ğŸ“¸ ä¿å­˜ç»“æœä¸ºå›¾ç‰‡</button>
            <div class="footnote">ç‚¹å‡»ä»»ä¸€å› å­æŸ¥çœ‹è¯¦ç»†è§£é‡Š</div>
        </div>
    </div>

    <!-- å› å­è¯¦æƒ…è§†å›¾ -->
    <div id="detailView" class="view">
        <div class="centered-wrapper">
            <div class="result-header">
                <button class="back-btn" id="backToResultBtn">â†</button>
                <div class="title-main" id="detailFactorName">å› å­åç§°</div>
                <div style="width:32px;"></div>
            </div>
            <div class="detail-card">
                <div class="detail-sub" id="detailSub">å¾—åˆ†ä¸ä¸´ç•Œ</div>
                <div class="detail-content" id="detailDescription">è¯¦ç»†è§£é‡Šè½½å…¥ä¸­...</div>
                <div class="detail-score" id="detailScoreBox"></div>
                <div class="level-desc" id="levelDescription"></div>
            </div>
            <button class="back-from-detail" id="backToResultFromDetailBtn">è¿”å›ç»“æœæ€»è§ˆ</button>
            <div class="developer">å¼€å‘è€…ï¼šDOMINO Â· ç‰ˆæœ¬ 1.01</div>
        </div>
    </div>
</div>

<script>
(function() {
    const VALID_PASSWORD = "1234";

    const items = [
        { num: 1, text: "å¤´ç—›", factor: "som" },
        { num: 2, text: "ç¥ç»è¿‡æ•ï¼Œå¿ƒä¸­ä¸è¸å®", factor: "anx" },
        { num: 3, text: "å¤´è„‘ä¸­æœ‰ä¸å¿…è¦çš„æƒ³æ³•æˆ–å­—å¥ç›˜æ—‹", factor: "obs" },
        { num: 4, text: "å¤´æ™•æˆ–æ™•å€’", factor: "som" },
        { num: 5, text: "å¯¹å¼‚æ€§çš„å…´è¶£å‡é€€", factor: "dep" },
        { num: 6, text: "å¯¹æ—äººè´£å¤‡æ±‚å…¨", factor: "int" },
        { num: 7, text: "æ„Ÿåˆ°åˆ«äººèƒ½æ§åˆ¶æ‚¨çš„æ€æƒ³", factor: "psy" },
        { num: 8, text: "è´£æ€ªåˆ«äººåˆ¶é€ éº»çƒ¦", factor: "par" },
        { num: 9, text: "å¿˜æ€§å¤§", factor: "obs" },
        { num: 10, text: "æ‹…å¿ƒè‡ªå·±çš„è¡£é¥°æ•´é½åŠä»ªæ€çš„ç«¯æ­£", factor: "obs" },
        { num: 11, text: "å®¹æ˜“çƒ¦æ¼å’Œæ¿€åŠ¨", factor: "hos" },
        { num: 12, text: "èƒ¸ç—›", factor: "som" },
        { num: 13, text: "å®³æ€•ç©ºæ—·çš„åœºæ‰€æˆ–è¡—é“", factor: "pho" },
        { num: 14, text: "æ„Ÿåˆ°è‡ªå·±çš„ç²¾åŠ›ä¸‹é™ï¼Œæ´»åŠ¨å‡æ…¢", factor: "dep" },
        { num: 15, text: "æƒ³ç»“æŸè‡ªå·±çš„ç”Ÿå‘½", factor: "dep" },
        { num: 16, text: "å¬åˆ°æ—äººå¬ä¸åˆ°çš„å£°éŸ³", factor: "psy" },
        { num: 17, text: "å‘æŠ–", factor: "anx" },
        { num: 18, text: "æ„Ÿåˆ°å¤§å¤šæ•°äººéƒ½ä¸å¯ä¿¡ä»»", factor: "par" },
        { num: 19, text: "èƒƒå£ä¸å¥½", factor: "oth" },
        { num: 20, text: "å®¹æ˜“å“­æ³£", factor: "dep" },
        { num: 21, text: "åŒå¼‚æ€§ç›¸å¤„æ—¶æ„Ÿåˆ°å®³ç¾ä¸è‡ªåœ¨", factor: "int" },
        { num: 22, text: "æ„Ÿåˆ°å—éª—ï¼Œä¸­äº†åœˆå¥—æˆ–æœ‰äººæƒ³æŠ“ä½æ‚¨", factor: "par" },
        { num: 23, text: "æ— ç¼˜æ— æ•…åœ°çªç„¶æ„Ÿåˆ°å®³æ€•", factor: "anx" },
        { num: 24, text: "è‡ªå·±ä¸èƒ½æ§åˆ¶åœ°å¤§å‘è„¾æ°”", factor: "hos" },
        { num: 25, text: "æ€•å•ç‹¬å‡ºé—¨", factor: "pho" },
        { num: 26, text: "ç»å¸¸è´£æ€ªè‡ªå·±", factor: "dep" },
        { num: 27, text: "è…°ç—›", factor: "som" },
        { num: 28, text: "æ„Ÿåˆ°éš¾ä»¥å®Œæˆä»»åŠ¡", factor: "obs" },
        { num: 29, text: "æ„Ÿåˆ°å­¤ç‹¬", factor: "dep" },
        { num: 30, text: "æ„Ÿåˆ°è‹¦é—·", factor: "dep" },
        { num: 31, text: "è¿‡åˆ†æ‹…å¿§", factor: "dep" },
        { num: 32, text: "å¯¹äº‹ç‰©ä¸æ„Ÿå…´è¶£", factor: "dep" },
        { num: 33, text: "æ„Ÿåˆ°å®³æ€•", factor: "anx" },
        { num: 34, text: "æ‚¨çš„æ„Ÿæƒ…å®¹æ˜“å—åˆ°ä¼¤å®³", factor: "int" },
        { num: 35, text: "æ—äººèƒ½çŸ¥é“æ‚¨çš„ç§ä¸‹æƒ³æ³•", factor: "psy" },
        { num: 36, text: "æ„Ÿåˆ°åˆ«äººä¸ç†è§£æ‚¨ã€ä¸åŒæƒ…æ‚¨", factor: "int" },
        { num: 37, text: "æ„Ÿåˆ°äººä»¬å¯¹æ‚¨ä¸å‹å¥½ï¼Œä¸å–œæ¬¢æ‚¨", factor: "int" },
        { num: 38, text: "åšäº‹å¿…é¡»åšå¾—å¾ˆæ…¢ä»¥ä¿è¯åšå¾—æ­£ç¡®", factor: "obs" },
        { num: 39, text: "å¿ƒè·³å¾—å¾ˆå‰å®³", factor: "anx" },
        { num: 40, text: "æ¶å¿ƒæˆ–èƒƒéƒ¨ä¸èˆ’æœ", factor: "som" },
        { num: 41, text: "æ„Ÿåˆ°æ¯”ä¸ä¸Šä»–äºº", factor: "int" },
        { num: 42, text: "è‚Œè‚‰é…¸ç—›", factor: "som" },
        { num: 43, text: "æ„Ÿåˆ°æœ‰äººåœ¨ç›‘è§†æ‚¨ã€è°ˆè®ºæ‚¨", factor: "par" },
        { num: 44, text: "éš¾ä»¥å…¥ç¡", factor: "oth" },
        { num: 45, text: "åšäº‹å¿…é¡»åå¤æ£€æŸ¥", factor: "obs" },
        { num: 46, text: "éš¾ä»¥åšå‡ºå†³å®š", factor: "obs" },
        { num: 47, text: "æ€•ä¹˜ç”µè½¦ã€å…¬å…±æ±½è½¦ã€åœ°é“æˆ–ç«è½¦", factor: "pho" },
        { num: 48, text: "å‘¼å¸æœ‰å›°éš¾", factor: "som" },
        { num: 49, text: "ä¸€é˜µé˜µå‘å†·æˆ–å‘çƒ­", factor: "som" },
        { num: 50, text: "å› ä¸ºæ„Ÿåˆ°å®³æ€•è€Œé¿å¼€æŸäº›ä¸œè¥¿ã€åœºåˆæˆ–æ´»åŠ¨", factor: "pho" },
        { num: 51, text: "è„‘å­å˜ç©ºäº†", factor: "obs" },
        { num: 52, text: "èº«ä½“å‘éº»æˆ–åˆºç—›", factor: "som" },
        { num: 53, text: "å–‰å’™æœ‰æ¢—å¡æ„Ÿ", factor: "som" },
        { num: 54, text: "æ„Ÿåˆ°å‰é€”æ²¡æœ‰å¸Œæœ›", factor: "dep" },
        { num: 55, text: "ä¸èƒ½é›†ä¸­æ³¨æ„åŠ›", factor: "obs" },
        { num: 56, text: "æ„Ÿåˆ°èº«ä½“çš„æŸä¸€éƒ¨åˆ†è½¯å¼±æ— åŠ›", factor: "som" },
        { num: 57, text: "æ„Ÿåˆ°ç´§å¼ æˆ–å®¹æ˜“ç´§å¼ ", factor: "anx" },
        { num: 58, text: "æ„Ÿåˆ°æ‰‹æˆ–è„šå‘é‡", factor: "som" },
        { num: 59, text: "æƒ³åˆ°æ­»äº¡çš„äº‹", factor: "oth" },
        { num: 60, text: "åƒå¾—å¤ªå¤š", factor: "oth" },
        { num: 61, text: "å½“åˆ«äººçœ‹ç€æ‚¨æˆ–è°ˆè®ºæ‚¨æ—¶æ„Ÿåˆ°ä¸è‡ªåœ¨", factor: "int" },
        { num: 62, text: "æœ‰ä¸€äº›ä¸å±äºæ‚¨è‡ªå·±çš„æƒ³æ³•", factor: "psy" },
        { num: 63, text: "æœ‰æƒ³æ‰“äººæˆ–ä¼¤å®³ä»–äººçš„å†²åŠ¨", factor: "hos" },
        { num: 64, text: "é†’å¾—å¤ªæ—©", factor: "oth" },
        { num: 65, text: "å¿…é¡»åå¤æ´—æ‰‹ã€ç‚¹æ•°", factor: "obs" },
        { num: 66, text: "ç¡å¾—ä¸ç¨³ä¸æ·±", factor: "oth" },
        { num: 67, text: "æœ‰æƒ³æ‘”åæˆ–ç ´åä¸œè¥¿çš„æƒ³æ³•", factor: "hos" },
        { num: 68, text: "æœ‰ä¸€äº›åˆ«äººæ²¡æœ‰çš„æƒ³æ³•", factor: "par" },
        { num: 69, text: "æ„Ÿåˆ°å¯¹åˆ«äººç¥ç»è¿‡æ•", factor: "int" },
        { num: 70, text: "åœ¨å•†åº—æˆ–ç”µå½±é™¢ç­‰äººå¤šçš„åœ°æ–¹æ„Ÿåˆ°ä¸è‡ªåœ¨", factor: "pho" },
        { num: 71, text: "æ„Ÿåˆ°ä»»ä½•äº‹æƒ…éƒ½å¾ˆå›°éš¾", factor: "dep" },
        { num: 72, text: "ä¸€é˜µé˜µææƒ§æˆ–æƒŠæ", factor: "anx" },
        { num: 73, text: "æ„Ÿåˆ°å…¬å…±åœºåˆåƒä¸œè¥¿å¾ˆä¸èˆ’æœ", factor: "int" },
        { num: 74, text: "ç»å¸¸ä¸äººäº‰è®º", factor: "hos" },
        { num: 75, text: "å•ç‹¬ä¸€äººæ—¶ç¥ç»å¾ˆç´§å¼ ", factor: "pho" },
        { num: 76, text: "åˆ«äººå¯¹æ‚¨çš„æˆç»©æ²¡æœ‰åšå‡ºæ°å½“çš„è¯„ä»·", factor: "par" },
        { num: 77, text: "å³ä½¿å’Œåˆ«äººåœ¨ä¸€èµ·ä¹Ÿæ„Ÿåˆ°å­¤å•", factor: "psy" },
        { num: 78, text: "æ„Ÿåˆ°åç«‹ä¸å®‰å¿ƒç¥ä¸å®š", factor: "anx" },
        { num: 79, text: "æ„Ÿåˆ°è‡ªå·±æ²¡æœ‰ä»€ä¹ˆä»·å€¼", factor: "dep" },
        { num: 80, text: "æ„Ÿåˆ°ç†Ÿæ‚‰çš„ä¸œè¥¿å˜æˆé™Œç”Ÿæˆ–ä¸åƒæ˜¯çœŸçš„", factor: "psy" },
        { num: 81, text: "å¤§å«æˆ–æ‘”ä¸œè¥¿", factor: "hos" },
        { num: 82, text: "å®³æ€•ä¼šåœ¨å…¬å…±åœºåˆæ™•å€’", factor: "pho" },
        { num: 83, text: "æ„Ÿåˆ°åˆ«äººæƒ³å æ‚¨çš„ä¾¿å®œ", factor: "par" },
        { num: 84, text: "ä¸ºä¸€äº›æœ‰å…³æ€§çš„æƒ³æ³•è€Œå¾ˆè‹¦æ¼", factor: "psy" },
        { num: 85, text: "æ‚¨è®¤ä¸ºåº”è¯¥å› ä¸ºè‡ªå·±çš„è¿‡é”™è€Œå—åˆ°æƒ©ç½š", factor: "psy" },
        { num: 86, text: "æ„Ÿåˆ°è¦å¾ˆå¿«æŠŠäº‹æƒ…åšå®Œ", factor: "anx" },
        { num: 87, text: "æ„Ÿåˆ°è‡ªå·±çš„èº«ä½“æœ‰ä¸¥é‡é—®é¢˜", factor: "psy" },
        { num: 88, text: "ä»æœªæ„Ÿåˆ°å’Œå…¶ä»–äººå¾ˆäº²è¿‘", factor: "psy" },
        { num: 89, text: "æ„Ÿåˆ°è‡ªå·±æœ‰ç½ª", factor: "oth" },
        { num: 90, text: "æ„Ÿåˆ°è‡ªå·±çš„è„‘å­æœ‰æ¯›ç—…", factor: "psy" }
    ];

    const factorMeta = {
        som: { name: "èº¯ä½“åŒ–", count: 12, max: 48, crit: 24, fullDesc: "è¯¥åˆ†é‡è¡¨ä¸»è¦åæ˜ ä¸»è§‚çš„èº«ä½“ä¸é€‚æ„Ÿï¼ŒåŒ…æ‹¬å¿ƒè¡€ç®¡ã€èƒƒè‚ é“ã€å‘¼å¸ç³»ç»Ÿä¸é€‚ï¼Œä»¥åŠå¤´ç—›ã€èƒŒç—›ã€è‚Œè‚‰é…¸ç—›å’Œç„¦è™‘çš„èº¯ä½“è¡¨ç°ã€‚\nå¾—åˆ†èŒƒå›´0-48åˆ†ã€‚å¾—åˆ†åœ¨24åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“åœ¨èº«ä½“ä¸Šæœ‰è¾ƒæ˜æ˜¾çš„ä¸é€‚æ„Ÿï¼Œå¹¶å¸¸ä¼´æœ‰å¤´ç—›ã€è‚Œè‚‰é…¸ç—›ç­‰ç—‡çŠ¶ã€‚å¾—åˆ†åœ¨12åˆ†ä»¥ä¸‹ï¼Œèº¯ä½“ç—‡çŠ¶è¡¨ç°ä¸æ˜æ˜¾ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œèº¯ä½“çš„ä¸é€‚æ„Ÿè¶Šå¼ºï¼›å¾—åˆ†è¶Šä½ï¼Œç—‡çŠ¶ä½“éªŒè¶Šä¸æ˜æ˜¾ã€‚" },
        obs: { name: "å¼ºè¿«ç—‡çŠ¶", count: 10, max: 40, crit: 20, fullDesc: "ä¸»è¦æŒ‡é‚£äº›æ˜çŸ¥æ²¡æœ‰å¿…è¦ï¼Œä½†åˆæ— æ³•æ‘†è„±çš„æ— æ„ä¹‰æ€æƒ³ã€å†²åŠ¨ã€è¡Œä¸ºï¼Œä»¥åŠä¸€äº›è®¤çŸ¥éšœç¢çš„è¡Œä¸ºå¾è±¡ã€‚\nå¾—åˆ†èŒƒå›´0-40åˆ†ã€‚å¾—åˆ†åœ¨20åˆ†ä»¥ä¸Šï¼Œå¼ºè¿«ç—‡çŠ¶è¾ƒæ˜æ˜¾ã€‚å¾—åˆ†åœ¨10åˆ†ä»¥ä¸‹ï¼Œå¼ºè¿«ç—‡çŠ¶ä¸æ˜æ˜¾ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œè¡¨æ˜ä¸ªä½“è¶Šæ— æ³•æ‘†è„±ä¸€äº›æ— æ„ä¹‰çš„è¡Œä¸ºã€æ€æƒ³å’Œå†²åŠ¨ï¼Œå¹¶å¯èƒ½è¡¨ç°å‡ºä¸€äº›è®¤çŸ¥éšœç¢çš„è¡Œä¸ºå¾å…†ã€‚å¾—åˆ†è¶Šä½ï¼Œè¡¨æ˜ä¸ªä½“åœ¨æ­¤ç§ç—‡çŠ¶ä¸Šè¡¨ç°è¶Šä¸æ˜æ˜¾ï¼Œæ²¡æœ‰å‡ºç°å¼ºè¿«è¡Œä¸ºã€‚" },
        int: { name: "äººé™…å…³ç³»æ•æ„Ÿ", count: 9, max: 36, crit: 18, fullDesc: "ä¸»è¦æŒ‡ä¸ªäººä¸è‡ªåœ¨æ„Ÿå’Œè‡ªå‘æ„Ÿï¼Œå°¤å…¶æ˜¯åœ¨ä¸ä»–äººæ¯”è¾ƒæ—¶æ›´çªå‡ºã€‚è¡¨ç°ä¸ºäººé™…äº¤å¾€ä¸­çš„è‡ªå‘ã€å¿ƒç¥ä¸å®‰ã€æ¶ˆææœŸå¾…ç­‰ã€‚\nå¾—åˆ†èŒƒå›´0-36åˆ†ã€‚å¾—åˆ†åœ¨18åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“äººé™…å…³ç³»è¾ƒä¸ºæ•æ„Ÿï¼Œäººé™…äº¤å¾€ä¸­è‡ªå‘æ„Ÿè¾ƒå¼ºï¼Œå¹¶ä¼´æœ‰è¡Œä¸ºç—‡çŠ¶ï¼ˆå¦‚åç«‹ä¸å®‰ï¼Œé€€ç¼©ç­‰ï¼‰ã€‚å¾—åˆ†åœ¨9åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“åœ¨äººé™…å…³ç³»ä¸Šè¾ƒä¸ºæ­£å¸¸ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œä¸ªä½“åœ¨äººé™…äº¤å¾€ä¸­è¡¨ç°çš„é—®é¢˜å°±è¶Šå¤šï¼Œè‡ªå‘ï¼Œè‡ªæˆ‘ä¸­å¿ƒè¶Šçªå‡ºï¼Œå¹¶å·²è¡¨ç°å‡ºæ¶ˆæçš„æœŸå¾…ã€‚å¾—åˆ†è¶Šä½ï¼Œä¸ªä½“åœ¨äººé™…å…³ç³»ä¸Šè¶Šèƒ½åº”ä»˜è‡ªå¦‚ï¼Œäººé™…äº¤æµè‡ªä¿¡ã€èƒ¸æœ‰æˆç«¹ï¼Œå¹¶æŠ±æœ‰ç§¯æçš„æœŸå¾…ã€‚" },
        dep: { name: "æŠ‘éƒ", count: 13, max: 52, crit: 26, fullDesc: "ä»¥è‹¦é—·çš„å¿ƒå¢ƒä¸ºä»£è¡¨æ€§ç—‡çŠ¶ï¼Œè¿˜è¡¨ç°ä¸ºç”Ÿæ´»å…´è¶£å‡é€€ã€åŠ¨åŠ›ç¼ºä¹ã€æ´»åŠ›ä¸§å¤±ã€å¤±æœ›ã€æ‚²è§‚ï¼Œä»¥åŠæœ‰å…³æ­»äº¡çš„æ€æƒ³ã€‚\nå¾—åˆ†èŒƒå›´0-52åˆ†ã€‚å¾—åˆ†åœ¨26åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“çš„æŠ‘éƒç¨‹åº¦è¾ƒå¼ºï¼Œç”Ÿæ´»ç¼ºä¹è¶³å¤Ÿçš„å…´è¶£ï¼Œç¼ºä¹è¿åŠ¨æ´»åŠ›ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæœ‰æƒ³æ­»äº¡çš„æ€æƒ³å’Œè‡ªæ€çš„è§‚å¿µã€‚å¾—åˆ†åœ¨13åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“æŠ‘éƒç¨‹åº¦è¾ƒå¼±ï¼Œç”Ÿæ´»æ€åº¦ä¹è§‚ç§¯æï¼Œå……æ»¡æ´»åŠ›ï¼Œå¿ƒå¢ƒæ„‰å¿«ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼ŒæŠ‘éƒç¨‹åº¦è¶Šæ˜æ˜¾ï¼Œå¾—åˆ†è¶Šä½ï¼ŒæŠ‘éƒç¨‹åº¦è¶Šä¸æ˜æ˜¾ã€‚" },
        anx: { name: "ç„¦è™‘", count: 10, max: 40, crit: 20, fullDesc: "ä¸€èˆ¬æŒ‡çƒ¦èºã€åç«‹ä¸å®‰ã€ç¥ç»è¿‡æ•ã€ç´§å¼ ä»¥åŠç”±æ­¤äº§ç”Ÿçš„èº¯ä½“å¾è±¡ï¼ˆå¦‚éœ‡é¢¤ï¼‰ã€‚\nå¾—åˆ†èŒƒå›´0-40åˆ†ã€‚å¾—åˆ†åœ¨20åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“è¾ƒæ˜“ç„¦è™‘ï¼Œæ˜“è¡¨ç°å‡ºçƒ¦èºã€ä¸å®‰é™å’Œç¥ç»è¿‡æ•ï¼Œæç«¯æ—¶å¯èƒ½å¯¼è‡´æƒŠæå‘ä½œã€‚å¾—åˆ†åœ¨10åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“ä¸æ˜“ç„¦è™‘ï¼Œæ˜“è¡¨ç°å‡ºå®‰å®šçš„çŠ¶æ€ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œç„¦è™‘è¡¨ç°è¶Šæ˜æ˜¾ã€‚å¾—åˆ†è¶Šä½ï¼Œè¶Šä¸ä¼šå¯¼è‡´ç„¦è™‘ã€‚" },
        hos: { name: "æ•Œå¯¹", count: 6, max: 24, crit: 12, fullDesc: "ä»æ€æƒ³ã€æ„Ÿæƒ…åŠè¡Œä¸ºä¸‰æ–¹é¢åæ˜ æ•Œå¯¹è¡¨ç°ï¼ŒåŒ…æ‹¬åŒçƒ¦ã€æ‘”ç‰©ã€äº‰è®ºç›´è‡³ä¸å¯æ§åˆ¶çš„è„¾æ°”çˆ†å‘ã€‚\nå¾—åˆ†èŒƒå›´0-24åˆ†ã€‚å¾—åˆ†åœ¨12åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“æ˜“è¡¨ç°å‡ºæ•Œå¯¹çš„æ€æƒ³ã€æƒ…æ„Ÿå’Œè¡Œä¸ºã€‚å¾—åˆ†åœ¨6åˆ†ä»¥ä¸‹è¡¨æ˜ä¸ªä½“å®¹æ˜“è¡¨ç°å‡ºå‹å¥½çš„æ€æƒ³ã€æƒ…æ„Ÿå’Œè¡Œä¸ºã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œä¸ªä½“è¶Šå®¹æ˜“æ•Œå¯¹ï¼Œå¥½äº‰è®ºï¼Œè„¾æ°”éš¾ä»¥æ§åˆ¶ã€‚å¾—åˆ†è¶Šä½ï¼Œä¸ªä½“çš„è„¾æ°”è¶Šæ¸©å’Œï¼Œå¾…äººå‹å¥½ï¼Œä¸å–œæ¬¢äº‰è®ºã€æ— ç ´åè¡Œä¸ºã€‚" },
        pho: { name: "ææ€–", count: 7, max: 28, crit: 14, fullDesc: "ææƒ§å¯¹è±¡åŒ…æ‹¬å‡ºé—¨æ—…è¡Œã€ç©ºæ—·åœºåœ°ã€äººç¾¤ã€å…¬å…±åœºæ‰€ä»¥åŠç¤¾äº¤ææ€–ã€‚\nå¾—åˆ†èŒƒå›´0-28åˆ†ã€‚å¾—åˆ†åœ¨14åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“ææ€–ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œå¸¸è¡¨ç°å‡ºç¤¾äº¤ã€å¹¿åœºå’Œäººç¾¤ææƒ§ï¼Œå¾—åˆ†åœ¨7åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“çš„ææ€–ç—‡çŠ¶ä¸æ˜æ˜¾ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œä¸ªä½“è¶Šå®¹æ˜“å¯¹ä¸€äº›åœºæ‰€å’Œç‰©ä½“å‘ç”Ÿææƒ§ï¼Œå¹¶ä¼´æœ‰æ˜æ˜¾çš„èº¯ä½“ç—‡çŠ¶ã€‚å¾—åˆ†è¶Šä½ï¼Œä¸ªä½“è¶Šä¸æ˜“äº§ç”Ÿææ€–å¿ƒç†ï¼Œè¶Šèƒ½æ­£å¸¸çš„äº¤å¾€å’Œæ´»åŠ¨ã€‚" },
        par: { name: "åæ‰§", count: 6, max: 24, crit: 12, fullDesc: "ä¸»è¦æŒ‡çŒœç–‘ã€å…³ç³»å¦„æƒ³ã€æŠ•å°„æ€§æ€ç»´ã€æ•Œå¯¹ã€è¢«åŠ¨ä½“éªŒå’Œå¤¸å¤§ç­‰ã€‚\nå¾—åˆ†èŒƒå›´0-24åˆ†ã€‚å¾—åˆ†åœ¨12åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“çš„åæ‰§ç—‡çŠ¶æ˜æ˜¾ï¼Œè¾ƒæ˜“çŒœç–‘å’Œæ•Œå¯¹ï¼Œå¾—åˆ†åœ¨6åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“çš„åæ‰§ç—‡çŠ¶ä¸æ˜æ˜¾ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œä¸ªä½“è¶Šæ˜“åæ‰§ï¼Œè¡¨ç°å‡ºæŠ•å°„æ€§çš„æ€ç»´å’Œå¦„æƒ³ï¼Œå¾—åˆ†è¶Šä½ï¼Œä¸ªä½“æ€ç»´è¶Šä¸æ˜“èµ°æç«¯ã€‚" },
        psy: { name: "ç²¾ç¥ç—…æ€§", count: 10, max: 40, crit: 20, fullDesc: "åæ˜ å„å¼å„æ ·çš„æ€¥æ€§ç—‡çŠ¶å’Œè¡Œä¸ºï¼ŒåŒ…æ‹¬å¹»å¬ã€æ€ç»´æ’­æ•£ã€è¢«æ´æ‚‰æ„Ÿç­‰ç²¾ç¥åˆ†è£‚æ ·ç—‡çŠ¶ã€‚\nå¾—åˆ†èŒƒå›´0-40åˆ†ã€‚å¾—åˆ†åœ¨20åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“çš„ç²¾ç¥ç—…æ€§ç—‡çŠ¶è¾ƒä¸ºæ˜æ˜¾ï¼Œå¾—åˆ†åœ¨10åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“çš„ç²¾ç¥ç—…æ€§ç—‡çŠ¶ä¸æ˜æ˜¾ã€‚æ€»çš„è¯´æ¥ï¼Œå¾—åˆ†è¶Šé«˜ï¼Œè¶Šå¤šçš„è¡¨ç°å‡ºç²¾ç¥ç—…æ€§ç—‡çŠ¶å’Œè¡Œä¸ºã€‚å¾—åˆ†è¶Šä½ï¼Œå°±è¶Šå°‘è¡¨ç°å‡ºè¿™äº›ç—‡çŠ¶å’Œè¡Œä¸ºã€‚" },
        oth: { name: "å…¶ä»– (ç¡çœ /é¥®é£Ÿ)", count: 7, max: 28, crit: 14, fullDesc: "ä¸»è¦åæ˜ ç¡çœ åŠé¥®é£Ÿæƒ…å†µã€‚å¾—åˆ†èŒƒå›´0-28åˆ†ã€‚å¾—åˆ†åœ¨14åˆ†ä»¥ä¸Šï¼Œè¡¨æ˜ä¸ªä½“ç¡çœ é¥®é£Ÿé—®é¢˜è¾ƒæ˜æ˜¾ï¼Œå¾—åˆ†åœ¨7åˆ†ä»¥ä¸‹ï¼Œè¡¨æ˜ä¸ªä½“ç¡çœ é¥®é£Ÿé—®é¢˜ä¸æ˜æ˜¾ã€‚å¾—åˆ†è¶Šé«˜ï¼Œç¡çœ é¥®é£Ÿé—®é¢˜è¶Šçªå‡ºã€‚" }
    };

    let scores = new Array(90).fill(null);
    let currentIndex = 0;

    const quizView = document.getElementById('quizView');
    const passwordView = document.getElementById('passwordView');
    const resultView = document.getElementById('resultView');
    const detailView = document.getElementById('detailView');
    const qNumDiv = document.getElementById('qNum');
    const qTextDiv = document.getElementById('qText');
    const optionGrid = document.getElementById('optionGrid');
    const progressFill = document.getElementById('progressFill');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const backToResultBtn = document.getElementById('backToResultBtn');
    const backToResultFromDetailBtn = document.getElementById('backToResultFromDetailBtn');
    const resultGrid = document.getElementById('resultGrid');
    const globalStatsResult = document.getElementById('globalStatsResult');
    const detailFactorName = document.getElementById('detailFactorName');
    const detailSub = document.getElementById('detailSub');
    const detailDescription = document.getElementById('detailDescription');
    const detailScoreBox = document.getElementById('detailScoreBox');
    const levelDescription = document.getElementById('levelDescription');
    const captureBtn = document.getElementById('captureResultBtn');

    const passwordInput = document.getElementById('passwordInput');
    const submitPasswordBtn = document.getElementById('submitPasswordBtn');
    const passwordError = document.getElementById('passwordError');
    const backToQuizFromPasswordBtn = document.getElementById('backToQuizFromPasswordBtn');

    function countAnswered() { return scores.filter(v => v !== null).length; }
    function updateProgress() { progressFill.style.width = (countAnswered() / 90 * 100) + '%'; }
    function isAllAnswered() { return scores.every(v => v !== null); }

    function updateNavButtons() {
        prevBtn.disabled = (currentIndex === 0);
        if (currentIndex === 89) nextBtn.disabled = (scores[currentIndex] === null);
        else nextBtn.disabled = (scores[currentIndex] === null);
    }

    function renderCurrent() {
        if (currentIndex >= 90) return;
        const item = items[currentIndex];
        qNumDiv.innerText = `ç¬¬ ${item.num} / 90 é¢˜`;
        qTextDiv.innerText = item.text;
        const labels = ['æ²¡æœ‰', 'å¾ˆè½»', 'ä¸­ç­‰', 'åé‡', 'ä¸¥é‡'];
        const letters = ['A', 'B', 'C', 'D', 'E'];
        let html = '';
        for (let val = 0; val <= 4; val++) {
            const selectedClass = (scores[currentIndex] === val) ? 'selected' : '';
            html += `<div class="option-btn ${selectedClass}" data-value="${val}"><span class="option-marker">${letters[val]}</span><span class="option-text">${labels[val]}</span></div>`;
        }
        optionGrid.innerHTML = html;
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                const value = parseInt(this.dataset.value, 10);
                scores[currentIndex] = value;
                document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                updateProgress();
                if (!isAllAnswered() && currentIndex < 89) { currentIndex++; renderCurrent(); }
                else if (isAllAnswered()) showPasswordView();
                updateNavButtons();
            });
        });
        updateNavButtons();
    }

    function goPrev() { if (currentIndex > 0) { currentIndex--; renderCurrent(); } }
    function goNext() {
        if (scores[currentIndex] === null) return;
        if (currentIndex < 89) { currentIndex++; renderCurrent(); }
        else if (currentIndex === 89) showPasswordView();
    }

    function computeResults() {
        const sums = { som:0, obs:0, int:0, dep:0, anx:0, hos:0, pho:0, par:0, psy:0, oth:0 };
        items.forEach((item, idx) => sums[item.factor] += scores[idx]);
        const totalScore = scores.reduce((a,b) => a + b, 0);
        const positiveItems = scores.filter(s => s >= 1).length;
        const negativeItems = 90 - positiveItems;
        const positiveAvg = positiveItems ? (scores.filter(s => s >= 1).reduce((a,b)=>a+b,0) / positiveItems).toFixed(2) : 0;
        return { sums, totalScore, positiveItems, negativeItems, positiveAvg };
    }

    function showResultView() {
        const { sums, totalScore, positiveItems, negativeItems, positiveAvg } = computeResults();
        let gridHtml = '';
        for (let [key, meta] of Object.entries(factorMeta)) {
            const raw = sums[key];
            const mean = (raw / meta.count).toFixed(2);
            const percent = (raw / meta.max) * 100;
            gridHtml += `<div class="factor-card" data-factor="${key}"><div class="factor-header"><span>${meta.name}</span> <span>${raw}</span></div><div class="factor-bar"><div class="factor-fill" style="width:${percent}%;"></div></div><div class="factor-score">å‡åˆ†${mean} / ä¸´ç•Œâ‰¥${meta.crit}</div></div>`;
        }
        resultGrid.innerHTML = gridHtml;
        globalStatsResult.innerHTML = `<div>ğŸ“Š æ€»åˆ†: ${totalScore}</div><div>ğŸ“Œ æ€»æŒ‡æ•°: ${(totalScore/90).toFixed(2)}</div><div>ğŸ”¹ é˜³æ€§é¡¹ç›®: ${positiveItems}</div><div>ğŸ”¸ é˜´æ€§é¡¹ç›®: ${negativeItems}</div><div>ğŸ“ˆ é˜³æ€§å‡åˆ†: ${positiveAvg}</div>`;
        document.querySelectorAll('.factor-card').forEach(card => {
            card.addEventListener('click', (e) => showDetailView(card.dataset.factor, sums));
        });
        passwordView.classList.remove('active');
        resultView.classList.add('active');
    }

    function showPasswordView() {
        passwordInput.value = ''; passwordError.innerText = '';
        quizView.classList.remove('active');
        passwordView.classList.add('active');
        setTimeout(() => passwordInput.focus(), 100);
    }

    function showDetailView(factorKey, sums) {
        const meta = factorMeta[factorKey];
        const raw = sums[factorKey];
        const mean = (raw / meta.count).toFixed(2);
        const percent = (raw / meta.max) * 100;
        const lowBound = Math.floor(meta.crit / 2);
        detailFactorName.innerText = meta.name;
        detailSub.innerText = `å¾—åˆ† ${raw}  Â·  ä¸´ç•Œå€¼ â‰¥ ${meta.crit}`;
        detailDescription.innerText = meta.fullDesc;
        detailScoreBox.innerHTML = `<div style="font-weight:600; margin-bottom:8px;">æ‚¨çš„å¾—åˆ†è¯¦æƒ…</div><div>å› å­æ€»åˆ†: ${raw} (æ»¡åˆ† ${meta.max})</div><div>æ¡ç›®å‡åˆ†: ${mean}</div><div>è¶…è¿‡ä¸´ç•Œ: ${raw >= meta.crit ? 'æ˜¯ âš ï¸' : 'å¦'}</div><div class="factor-bar" style="margin-top:12px;"><div class="factor-fill" style="width:${percent}%;"></div></div>`;
        let levelHtml = '<div style="font-weight:600; margin-bottom:10px;">ğŸ“Š å¾—åˆ†åŒºé—´è§£è¯»</div>';
        levelHtml += `<div class="level-item">ğŸ”¹ å¾—åˆ† â‰¤ ${lowBound-1} ï¼š${meta.name}ç—‡çŠ¶ä¸æ˜æ˜¾ï¼Œè¡¨ç°è‰¯å¥½ã€‚</div>`;
        levelHtml += `<div class="level-item">ğŸ”¸ å¾—åˆ† ${lowBound}â€“${meta.crit-1} ï¼šå­˜åœ¨è½»åº¦åˆ°ä¸­åº¦ç—‡çŠ¶ï¼Œå¯å…³æ³¨ã€‚</div>`;
        levelHtml += `<div class="level-item">ğŸ”º å¾—åˆ† â‰¥ ${meta.crit} ï¼šç—‡çŠ¶æ˜æ˜¾ï¼Œå»ºè®®è¿›ä¸€æ­¥å…³æ³¨æˆ–å’¨è¯¢ã€‚</div>`;
        if (raw < lowBound) levelHtml = levelHtml.replace('ğŸ”¹', 'â–¶ æ‚¨çš„å¾—åˆ†å¤„äºè¯¥åŒºé—´');
        else if (raw < meta.crit) levelHtml = levelHtml.replace('ğŸ”¸', 'â–¶ æ‚¨çš„å¾—åˆ†å¤„äºè¯¥åŒºé—´');
        else levelHtml = levelHtml.replace('ğŸ”º', 'â–¶ æ‚¨çš„å¾—åˆ†å¤„äºè¯¥åŒºé—´');
        levelDescription.innerHTML = levelHtml;
        resultView.classList.remove('active');
        detailView.classList.add('active');
    }

    function backToResult() { detailView.classList.remove('active'); resultView.classList.add('active'); showResultView(); }
    function captureResult() {
        const element = document.getElementById('resultCapture');
        if (!element) return;
        html2canvas(element, { scale: 2, backgroundColor: '#ffffff' }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'PsyHealthè‡ªæµ‹é‡è¡¨ç»“æœ.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }).catch(error => alert('æˆªå›¾ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ã€‚' + error));
    }

    prevBtn.addEventListener('click', goPrev);
    nextBtn.addEventListener('click', goNext);
    backToResultBtn.addEventListener('click', backToResult);
    backToResultFromDetailBtn.addEventListener('click', backToResult);
    captureBtn.addEventListener('click', captureResult);
    submitPasswordBtn.addEventListener('click', () => {
        const entered = passwordInput.value.trim();
        if (entered === VALID_PASSWORD) { passwordError.innerText = ''; showResultView(); }
        else { passwordError.innerText = 'âŒ å£ä»¤é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥'; passwordInput.value = ''; passwordInput.focus(); }
    });
    passwordInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') { e.preventDefault(); submitPasswordBtn.click(); } });
    backToQuizFromPasswordBtn.addEventListener('click', () => { passwordView.classList.remove('active'); quizView.classList.add('active'); renderCurrent(); });

    renderCurrent();
    updateProgress();
})();
</script>
</body>
</html>